---
import { getLocale } from "@lib/i18n";
import { cmsApi, getBlockFromArray, getBlockObjectValues } from "@lib/index";
import Button from "@components/Button/Button.astro";

const { getCollection, getImageUrl } = cmsApi();
const websiteCollection = await getCollection("website");
const currLocale = getLocale(Astro.currentLocale);
const info = getBlockFromArray(websiteCollection, "info", currLocale);
const aboutTitle = info.aboutTitle;
const aboutContent = info.aboutContent;
const aboutImage = info.aboutImage;
---

<section id="about" class="bg-secondary py-16 md:py-24">
	<div class="site-container">
		<div class="grid items-center gap-12 lg:grid-cols-2">
			<figure class="order-2 lg:order-1 about-image gsap-slide-left">
				{
					aboutImage ? (
						<div class="relative">
							<div
								class="absolute inset-0 rounded-3xl blur-sm"
								style="background-color: rgba(0,0,0,0.3);"
							/>
							<img
								referrerpolicy="no-referrer"
								src={getImageUrl(aboutImage)}
								alt={aboutTitle}
								class="relative w-full rounded-3xl object-cover shadow-lg transition-transform duration-500 hover:scale-[1.02]"
								style="filter: drop-shadow(0 2px 6px rgba(0,0,0,0.4));"
							/>
						</div>
					) : (
						<div class="bg-muted border-primary flex justify-center rounded-3xl border px-4 py-16 text-5xl shadow-lg">
							ðŸš€
						</div>
					)
				}
			</figure>
			<div class="order-1 space-y-6 lg:order-2 about-content gsap-slide-right">
				<h2 class="main-text-gradient text-4xl font-bold md:text-5xl gsap-fade-up" data-delay="0.2">
					{aboutTitle}
				</h2>
				<div class="prose prose-lg text-secondary max-w-none gsap-fade-up" data-delay="0.4">
					{aboutContent}
				</div>
				<div class="flex flex-wrap gap-4 pt-4 gsap-stagger">
					<Button variant="primary" class="hover-lift px-6 py-3 gsap-stagger-item"> Our Process </Button>
					<Button variant="outline" class="hover-lift px-6 py-3 gsap-stagger-item"> Contact Us </Button>
				</div>
			</div>
		</div>
	</div>
</section>

<script type="module">
	import { gsap } from '/src/lib/gsap-init.js';
	
	// Enhanced About Section Animations
	function initAboutAnimations() {
		console.log('âœ¨ Initializing PowerPoint-style About Animations');
		
		// Enhanced image hover effect
		const aboutImage = document.querySelector('.about-image img');
		if (aboutImage) {
			aboutImage.addEventListener('mouseenter', () => {
				gsap.to(aboutImage, { 
					scale: 1.08, 
					rotation: 1,
					filter: "brightness(1.1) contrast(1.1)",
					duration: 0.4, 
					ease: "power2.out" 
				});
			});
			
			aboutImage.addEventListener('mouseleave', () => {
				gsap.to(aboutImage, { 
					scale: 1, 
					rotation: 0,
					filter: "brightness(1) contrast(1)",
					duration: 0.4, 
					ease: "power2.out" 
				});
			});
		}
		
		// Enhanced button animations
		document.querySelectorAll('.hover-lift').forEach(button => {
			button.addEventListener('mouseenter', () => {
				gsap.to(button, { 
					y: -5, 
					scale: 1.08,
					boxShadow: "0 15px 30px rgba(0,0,0,0.15)",
					duration: 0.3, 
					ease: "back.out(1.7)" 
				});
			});
			
			button.addEventListener('mouseleave', () => {
				gsap.to(button, { 
					y: 0, 
					scale: 1,
					boxShadow: "0 4px 6px rgba(0,0,0,0.1)",
					duration: 0.3, 
					ease: "power2.out" 
				});
			});
		});
	}
	
	// Initialize animations
	document.addEventListener('DOMContentLoaded', initAboutAnimations);
	document.addEventListener('astro:after-swap', initAboutAnimations);
</script>
